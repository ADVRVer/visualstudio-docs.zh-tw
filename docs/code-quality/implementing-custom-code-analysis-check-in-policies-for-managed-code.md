---
title: "為 Managed 程式碼實作自訂程式碼分析簽入原則 | Microsoft Docs"
ms.custom: ""
ms.date: "12/12/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-general"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "vs.code.analysis.selecttfsrulesets"
  - "vs.code.analysis.browsefortfsruleset"
  - "vs.code.analysis.policyeditor"
ms.assetid: fd029003-5671-4b24-8b6f-032e0a98b2e8
caps.latest.revision: 21
caps.handback.revision: 21
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# 為 Managed 程式碼實作自訂程式碼分析簽入原則
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

程式碼分析簽入原則指定在簽入版本控制前 Team 專案成員必須對原始程式碼執行的一組規則。  Microsoft 提供將程式碼分析規則分組成功能區域的一組標準「*規則集*」\(Rule Set\)。  「*自訂簽入原則規則集*」\(Custom Check\-in Policy Rule Set\) 指定 Team 專案特定的一組程式碼分析規則。  規則集儲存在 .ruleset 檔案中。  
  
 簽入原則是在 Team 專案層級設定並且由版本控制樹狀結構中的 .ruleset 檔案位置所指定。  小組原則自訂規則集的版本控制位置不受限制。  
  
 程式碼分析是在每個程式碼專案的屬性視窗中為個別程式碼專案設定的。  程式碼專案的自訂規則集是由本機電腦上 .ruleset 檔案的實體位置所指定。  指定的 .ruleset 檔案與程式碼專案位於相同磁碟機時， Visual Studio會在專案組態中使用檔案的相對路徑。  
  
 建立 Team 專案自訂規則集的建議作法是，將簽入原則 .ruleset 檔案儲存在不屬於任何程式碼專案的特殊資料夾中。  如果將此檔案儲存在專用資料夾，您可以套用權限來限制可編輯規則檔案的人員，也可以輕鬆將包含專案的目錄結構移至另一個目錄或電腦。  
  
## 建立 Team 專案的自訂簽入規則集  
 若要建立 Team 專案的自訂規則集，請先在 \[**原始檔控制總管**\] 中建立簽入原則規則集的特殊資料夾。  接著建立規則集檔案並將檔案加入至版本控制。  最後將規則集指定為 Team 專案的程式碼分析簽入原則。  
  
> [!NOTE]
>  若要在 Team 專案中建立資料夾，必須先將 Team 專案根目錄對應至本機電腦上的位置。  如需詳細資訊，請參閱[Create and work with workspaces \(old\)](http://msdn.microsoft.com/zh-tw/db4d5692-179a-44fe-ad31-0c1c900c9cb2)。  
  
#### 若要建立簽入原則規則集的版本控制資料夾  
  
1.  在 [!INCLUDE[esprtfc](../code-quality/includes/esprtfc_md.md)]中展開 Team 專案節點，然後按一下 \[**原始檔控制**\]。  
  
2.  在 \[**資料夾**\] 窗格中，以滑鼠右鍵按一下 Team 專案，然後按一下 \[**新增資料夾**\]。  
  
3.  在 \[原始檔控制\] 主窗格中，以滑鼠右鍵按一下 \[**新增資料夾**\]，然後按一下 \[**重新命名**\]，並輸入規則集資料夾的名稱。  
  
#### 若要建立簽入原則規則集  
  
1.  在 \[**檔案**\] 功能表上指向 \[**新增**\]，然後按一下 \[**檔案**\]。  
  
2.  在 \[**分類**\] 清單中，按一下 \[**一般**\]。  
  
3.  在 \[**範本**\] 清單中，按兩下 \[**程式碼分析規則集**\]。  
  
4.  指定要包含在規則集的規則，然後將規則集檔案儲存至剛建立的規則集資料夾。  
  
     如需詳細資訊，請參閱[建立自訂規則集](../code-quality/creating-custom-code-analysis-rule-sets.md)。  
  
#### 若要將規則集檔案加入至版本控制  
  
1.  在 \[**原始檔控制總管**\] 中，以滑鼠右鍵按一下新資料夾，然後按一下 \[**將項目加入到資料夾**\]。  
  
     如需詳細資訊，請參閱[使用版本控制](../Topic/Use%20version%20control.md)。  
  
2.  按一下剛建立的規則集檔案，然後按一下 \[**完成**\]。  
  
     此檔案隨即加入至原始檔控制並為您簽出。  
  
3.  在 \[**原始檔控制總管**\] 詳細資料視窗中，以滑鼠右鍵按一下檔案名稱，然後按一下 \[**簽入暫止的變更**\]。  
  
4.  在 \[**簽入**\] 對話方塊中，您可以選擇是否要加入註解，然後按一下 \[**簽入**\]。  
  
    > [!NOTE]
    >  如果您已經設定 Team 專案的程式碼分析簽入原則，而且已選取 \[**強制簽入，以僅包含屬於目前方案的檔案**\]，則會觸發原則失敗警告。  在 \[原則失敗\] 對話方塊中，選取 \[**覆寫原則失敗並繼續簽入**\]。  加入必要註解，然後按一下 \[**確定**\]。  
  
#### 若要將規則集檔案指定為簽入原則  
  
1.  在 \[**小組**\] 功能表上，指向 \[**Team 專案設定**\]，然後按一下 \[**原始檔控制**\]。  
  
2.  按一下 \[**簽入原則**\]，然後按一下 \[**加入**\]。  
  
3.  在 \[**簽入原則**\] 清單中，按兩下 \[**程式碼分析**\]，確定已選取 \[**對 Managed 程式碼強制執行程式碼分析**\] 核取方塊。  
  
4.  在 \[**執行此規則集**\] 清單中，按一下 \[**\<從原始檔控制選取規則集\>**\]。  
  
5.  輸入簽入原則規則集檔案在版本控制中的路徑。  
  
     此路徑必須符合下列語法：  
  
     **$\/** `TeamProjectName` **\/** `VersionControlPath`  
  
    > [!NOTE]
    >  您可以在 \[**原始檔控制總管**\] 中使用下列其中一個程序來複製路徑：  
  
    -   在 \[**資料夾**\] 窗格中，按一下包含規則集檔案的資料夾。  複製出現在 \[**原始檔**\] 方塊中的資料夾版本控制路徑，然後手動輸入規則集檔案的名稱。  
  
    -   在詳細資料視窗中，以滑鼠右鍵按一下規則集檔案，然後按一下 \[**內容**\]。  在 \[**一般**\] 索引標籤上，複製 \[**伺服器名稱**\] 中的值。  
  
## 將程式碼專案同步處理至簽入原則規則集  
 在程式碼專案的屬性對話方塊中，將 Team 專案的簽入原則規則集指定為程式碼專案組態的程式碼分析規則集。  如果規則集與程式碼專案位於相同磁碟機時，從檔案對話方塊中選取路徑時，則會使用相對路徑來指定規則集。  相對路徑可讓專案屬性設定能夠移植到其他使用類似本機版本控制結構的電腦。  
  
#### 若要將 Team 專案規則集指定為程式碼專案的規則集  
  
1.  如有需要，請從版本控制擷取簽入原則規則集資料夾和檔案。  
  
     您可以在 \[**原始檔控制總管**\] 中，以滑鼠右鍵按一下規則集資料夾，然後按一下 \[**取得最新的版本**\]，執行這個步驟。  
  
2.  在 \[**方案總管**\] 中，以滑鼠右鍵按一下程式碼專案，然後按一下 \[**內容**\]。  
  
3.  按一下 \[**程式碼分析**\]。  
  
4.  如有需要，在 \[**組態**\] 和 \[**平台**\] 清單中按一下適當選項。  
  
5.  若要在每一次使用指定的組態建置程式碼專案時執行程式碼分析，請選取 \[**建置時啟用程式碼分析 \(定義 CODE\_ANALYSIS 常數\)**\] 核取方塊。  
  
6.  若要忽略來自其他公司之元件中的程式碼，請選取 \[**隱藏所產生程式碼的結果**\] 核取方塊。  
  
7.  在 \[ **執行此規則集** \] 清單中，按一下 \[**\<瀏覽\>**\]。  
  
8.  指定簽入原則規則集檔案的本機版本。